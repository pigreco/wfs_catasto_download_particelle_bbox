<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WFS Catasto Download Particelle BBox - Guida</title>
    <style>
        :root {
            --primary-color: #2962FF;
            --secondary-color: #00897B;
            --accent-color: #FF6D00;
            --text-color: #333;
            --border-color: #ddd;
            --background-color: #f9f9f9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 10px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .nav {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .nav li {
            flex: 1;
            min-width: 200px;
        }
        
        .nav a {
            display: block;
            padding: 0.5rem 1rem;
            background: var(--background-color);
            text-decoration: none;
            color: var(--text-color);
            border-radius: 5px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .nav a:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .section {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.8rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }
        
        h3 {
            color: var(--secondary-color);
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
        }
        
        .mode-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            background: #fafafa;
            display: flex;
            gap: 1.5rem;
            align-items: start;
        }
        
        .mode-content {
            flex: 1;
        }
        
        .mode-image {
            flex-shrink: 0;
            width: 120px;
            height: 120px;
        }
        
        .mode-image img {
            width: 100%;
            height: 100%;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            padding: 4px;
        }
        
        .mode-card h4 {
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }
        
        .steps {
            background: #e8f4f8;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .steps h4 {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        
        ol, ul {
            margin: 1rem 0;
            padding-left: 2rem;
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }
        
        .info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }
        
        code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        .footer {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 10px;
            margin-top: 2rem;
        }
        
        .footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .nav ul {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìç WFS Catasto Download Particelle BBox</h1>
            <p class="subtitle">Guida Completa al Plugin QGIS</p>
        </header>

        <nav class="nav">
            <ul>
                <li><a href="#installazione">üîß Installazione</a></li>
                <li><a href="#modalita">üéØ Modalit√† d'uso</a></li>
                <li><a href="#configurazioni">‚öôÔ∏è Configurazioni</a></li>
                <li><a href="#troubleshooting">üö® Risoluzione Problemi</a></li>
            </ul>
        </nav>

        <section id="installazione" class="section">
            <h2>üîß Installazione</h2>
            <h3>Installazione da GitHub</h3>
            <ol>
                <li>Scarica l'ultima release dal <a href="https://github.com/pigreco/wfs_catasto_download_particelle_bbox/releases" target="_blank">repository GitHub</a></li>
                <li>Estrai il file ZIP in una cartella temporanea</li>
                <li>Copia la cartella <code>wfs_catasto_download_particelle_bbox</code> nella directory dei plugin QGIS:
                    <ul>
                        <li><strong>Windows:</strong> <code>%APPDATA%\QGIS\QGIS3\profiles\default\python\plugins\</code></li>
                        <li><strong>Linux:</strong> <code>~/.local/share/QGIS/QGIS3/profiles/default/python/plugins/</code></li>
                        <li><strong>macOS:</strong> <code>~/Library/Application Support/QGIS/QGIS3/profiles/default/python/plugins/</code></li>
                    </ul>
                </li>
                <li>Riavvia QGIS</li>
                <li>Attiva il plugin da <strong>Plugin ‚Üí Gestisci e installa plugin ‚Üí Installati</strong></li>
            </ol>
            
            <div class="info">
                <strong>üí° Tip:</strong> Il plugin comparir√† nel menu <strong>Plugin</strong> con tre opzioni: "Avvia Download Particelle Catastali", "Informazioni" e "Guida".
            </div>
        </section>

        <section id="modalita" class="section">
            <h2>üéØ Modalit√† d'uso</h2>
            
            <div class="mode-card">
                <div class="mode-content">
                    <h4>1. üìê Disegna BBox</h4>
                    <p>Disegna direttamente sulla mappa un rettangolo per definire l'area di download.</p>
                    
                    <div class="steps">
                        <h4>Procedura:</h4>
                        <ol>
                            <li>Seleziona "Disegna BBox sulla mappa"</li>
                            <li>Clicca sulla mappa per il primo angolo</li>
                            <li>Muovi il mouse per vedere l'anteprima del rettangolo</li>
                            <li>Clicca per il secondo angolo</li>
                            <li>Il download inizier√† automaticamente</li>
                        </ol>
                    </div>
                </div>
                <div class="mode-image">
                    <img src="sketches/sketches_bbox.svg" alt="Disegna BBox - Modalit√†" style="width: 100%; height: 100%; border: 1px solid var(--border-color); border-radius: 6px; background: white;"/>
                </div>
            </div>

            <div class="mode-card">
                <div class="mode-content">
                    <h4>2. üî∫ Seleziona Poligono</h4>
                    <p>Usa un poligono esistente in mappa per definire l'area di interesse.</p>
                    
                    <div class="steps">
                        <h4>Procedura:</h4>
                        <ol>
                            <li>Assicurati di avere un layer poligonale caricato</li>
                            <li>Seleziona "Seleziona Poligono sulla mappa"</li>
                            <li>Clicca su un poligono nella mappa</li>
                            <li>Il bounding box del poligono verr√† estratto automaticamente</li>
                            <li>Il download inizier√† automaticamente</li>
                        </ol>
                    </div>
                </div>
                <div class="mode-image">
                    <img src="sketches/sketches_polygon.svg" alt="Seleziona Poligono - Modalit√†" style="width: 100%; height: 100%; border: 1px solid var(--border-color); border-radius: 6px; background: white;"/>
                </div>
            </div>

            <div class="mode-card">
                <div class="mode-content">
                    <h4>3. üìè Seleziona Asse Stradale</h4>
                    <p>Crea un buffer intorno a una linea per scaricare le particelle adiacenti.</p>
                    
                    <div class="steps">
                        <h4>Procedura:</h4>
                        <ol>
                            <li>Imposta la distanza del buffer (0-100m)</li>
                            <li>Seleziona "Seleziona Asse Stradale"</li>
                            <li>Clicca su una linea nella mappa o disegna una polilinea</li>
                            <li>Verr√† creato automaticamente un buffer della distanza impostata</li>
                            <li>Verranno scaricate solo le particelle che intersecano il buffer</li>
                        </ol>
                    </div>
                    
                    <div class="warning">
                        <strong>‚ö†Ô∏è Attenzione:</strong> Per la modalit√† asse stradale, il layer deve avere un CRS proiettato (metri).
                    </div>
                </div>
                <div class="mode-image">
                    <img src="sketches/sketches_line.svg" alt="Seleziona Asse Stradale - Modalit√†" style="width: 100%; height: 100%; border: 1px solid var(--border-color); border-radius: 6px; background: white;"/>
                </div>
            </div>

            <div class="mode-card">
                <div class="mode-content">
                    <h4>4. üìç Seleziona Punti</h4>
                    <p>Usa punti esistenti o disegnati per scaricare le particelle che li contengono. Supporta quattro scenari d'uso combinabili.</p>

                    <div class="steps">
                        <h4>Parametri disponibili nel dialogo:</h4>
                        <ul>
                            <li><strong>Buffer:</strong> distanza in metri attorno a ciascun punto (default 1 m)</li>
                            <li><strong>Snap:</strong> tolleranza in pixel per il click sulla mappa</li>
                            <li><strong>Sorgente:</strong> layer di punti da usare come input (opzionale)</li>
                            <li><strong>Aggiungi a:</strong> layer Particelle WFS esistente in cui accodare le nuove particelle (opzionale)</li>
                        </ul>
                    </div>

                    <div class="steps">
                        <h4>Due modalit√† di funzionamento:</h4>
                        <ul>
                            <li>
                                <strong>Sorgente = "(clicca sulla mappa)"</strong> ‚Äî modalit√† interattiva a click.<br>
                                Ogni click sulla mappa scarica la particella catastale nel punto cliccato e la accumula nello stesso layer di sessione.
                                Premi <strong>ESC</strong> per terminare la sessione e riaprire il dialogo.
                                Se hai impostato <em>Aggiungi a</em>, le particelle vengono accodate al layer selezionato; altrimenti viene creato un nuovo layer al primo click e i click successivi vi vengono aggiunti.
                            </li>
                            <li>
                                <strong>Sorgente = layer specifico</strong> ‚Äî modalit√† automatica.<br>
                                Scegli un layer di punti dalla combo <em>Sorgente</em>: il download parte automaticamente, senza dover cliccare sulla mappa.
                                Vengono usati i punti selezionati (se presenti) oppure tutti i punti del layer.
                                Al termine il dialogo si riapre automaticamente.
                            </li>
                        </ul>
                    </div>

                    <div class="steps">
                        <h4>Come usare "Aggiungi a":</h4>
                        <ul>
                            <li><strong>Aggiungi a = "(nuovo layer)"</strong> ‚Äî il risultato finisce in un nuovo layer temporaneo (comportamento predefinito)</li>
                            <li><strong>Aggiungi a = layer esistente</strong> ‚Äî le particelle vengono accodate al layer Particelle WFS selezionato. La selezione viene mantenuta tra un ciclo e l'altro. Compatibile con entrambe le modalit√† Sorgente.</li>
                        </ul>
                    </div>

                    <div class="info">
                        <strong>üí° Tip:</strong> Le combo <em>Sorgente</em> e <em>Aggiungi a</em> sono combinabili: puoi usare un layer sorgente <strong>e</strong> accodare il risultato a un layer esistente in una sola operazione. Dopo ogni download viene mostrata una notifica nella barra messaggi QGIS con il numero di particelle caricate.
                    </div>

                    <div class="info">
                        <strong>üîÑ Selezione parziale:</strong> Se nel layer di punti sorgente sono presenti punti selezionati, verranno usati solo quelli; altrimenti tutti i punti del layer.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è CRS geografico:</strong> Se il layer di punti usa un CRS geografico (gradi), il plugin esegue automaticamente una riproiezione UTM per calcolare correttamente il buffer.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Punti in mare o fuori dalla copertura catastale:</strong> Se uno o pi√π punti del layer cadono in mare, su un lago o in un'area priva di dati catastali (es. zone militari, aree estere), il download restituir√† "Nessuna feature". Il servizio WFS dell'Agenzia delle Entrate copre solo il territorio italiano continentale e insulare con dati catastali disponibili. <strong>Soluzione:</strong> seleziona manualmente solo i punti su terraferma prima di avviare il download; il plugin utilizzer√† automaticamente solo i punti selezionati.
                    </div>
                </div>
                <div class="mode-image">
                    <img src="sketches/sketches_points.svg" alt="Seleziona Punti - Modalit√†" style="width: 100%; height: 100%; border: 1px solid var(--border-color); border-radius: 6px; background: white;"/>
                </div>
            </div>
        </section>

        <section id="configurazioni" class="section">
            <h2>‚öôÔ∏è Configurazioni e Funzionalit√† Avanzate</h2>
            
            <h3>Espansione Riferimento Catastale</h3>
            <p>Il plugin pu√≤ estrarre dal campo <code>NATIONALCADASTRALREFERENCE</code> i seguenti campi strutturati:</p>
            <ul>
                <li><strong>Sezione:</strong> Codice sezione catastale</li>
                <li><strong>Foglio:</strong> Numero foglio</li>
                <li><strong>Allegato:</strong> Codice allegato</li>
                <li><strong>Sviluppo:</strong> Codice sviluppo</li>
            </ul>
            <p><em>Formato: CCCCZFFFFAS (dove CCCC=comune, Z=sezione, FFFF=foglio, A=allegato, S=sviluppo)</em></p>

            <h3>Download Multi-tile</h3>
            <p>Per aree estese, il plugin suddivide automaticamente la richiesta in tile pi√π piccoli:</p>
            <ul>
                <li>Progress bar per monitorare l'avanzamento</li>
                <li>Deduplicazione automatica delle feature</li>
                <li>Filtro spaziale per ottimizzare le prestazioni</li>
                <li>Download intervallato per non sovraccaricare il servizio</li>
            </ul>

            <h3>Stile Automatico</h3>
            <p>Il layer scaricato viene automaticamente stilizzato con regole basate sul contenuto:</p>
            <ul>
                <li><strong>Arancione:</strong> Particelle numeriche standard</li>
                <li><strong>Grigio:</strong> Strade (STRADA)</li>
                <li><strong>Blu:</strong> Acque (ACQUA)</li>
            </ul>

            <h3>WMS Cartografia Catastale</h3>
            <p>Il plugin pu√≤ caricare automaticamente il WMS dell'Agenzia delle Entrate con i seguenti layer:</p>
            <ul>
                <li>Province</li>
                <li>Mappe catastali</li>
                <li>Acque</li>
                <li>Strade</li>
                <li>Vestizioni</li>
                <li>Fabbricati</li>
                <li>Particelle</li>
            </ul>
        </section>

        <section id="troubleshooting" class="section">
            <h2>üö® Risoluzione Problemi</h2>
            
            <h3>Errori Comuni</h3>
            
            <div class="warning">
                <h4>Errore di CRS per Asse Stradale</h4>
                <p><strong>Soluzione:</strong> Assicurati che il layer lineare abbia un sistema di coordinate proiettato (metri) e non geografico (gradi).</p>
            </div>

            <div class="warning">
                <h4>Area troppo estesa</h4>
                <p><strong>Soluzione:</strong> Il plugin suddivide automaticamente aree grandi in tile. Se persiste l'errore, riduci l'area di interesse.</p>
            </div>

            <div class="warning">
                <h4>Timeout della connessione</h4>
                <p><strong>Soluzioni:</strong></p>
                <ul>
                    <li>Verifica la connessione internet</li>
                    <li>Riprova in un momento diverso (il servizio potrebbe essere sovraccarico)</li>
                    <li>Riduci l'area di download</li>
                </ul>
            </div>

            <h3>Limitazioni e Best Practices</h3>
            <ul>
                <li><strong>Uso responsabile:</strong> Evita download massivi ripetuti per non sovraccaricare il servizio WFS</li>
                <li><strong>Compatibilit√†:</strong> Supporta QGIS 3 (Qt5) e QGIS 4 (Qt6)</li>
                <li><strong>CRS:</strong> Il plugin gestisce automaticamente le riproiezioni necessarie</li>
                <li><strong>Performance:</strong> Per aree molto grandi, considera di suddividere manualmente il download</li>
            </ul>
        </section>

        <footer class="footer">
            <p>
                üìß <strong>Autore:</strong> Salvatore Fiandaca<br>
                üêô <strong>GitHub:</strong> <a href="https://github.com/pigreco/wfs_catasto_download_particelle_bbox" target="_blank">pigreco/wfs_catasto_download_particelle_bbox</a><br>
                üåê <strong>WFS Service:</strong> <a href="https://wfs.cartografia.agenziaentrate.gov.it/inspire/wfs" target="_blank">Agenzia delle Entrate INSPIRE</a>
            </p>
            
            <div class="info" style="margin-top: 1rem;">
                <strong>üìñ Documentazione Ufficiale:</strong><br>
                - <a href="https://www.agenziaentrate.gov.it/portale/web/guest/schede/fabbricatiterreni/consultazione-cartografia-catastale/servizi-consultazione-cartografia" target="_blank">Servizi Consultazione Cartografia Catastale</a><br>
                - <a href="https://www.agenziaentrate.gov.it/portale/documents/20143/233439/Manuale_tecnico_WMS_WFS_Cartografia_maggio2018.pdf" target="_blank">Manuale Tecnico WMS/WFS Cartografia (PDF)</a>
            </div>
            
            <p style="margin-top: 1rem; font-size: 0.9em; color: #666;">
                <em>Plugin rilasciato sotto licenza Open Source. Utilizza responsabilmente per non sovraccaricare i servizi dell'Agenzia delle Entrate.</em>
            </p>
        </footer>
    </div>
</body>
</html>